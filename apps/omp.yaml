# Part of zconfig ¬∑ https://github.com/barabasz/zconfig ¬∑ MIT License
#
# Oh My Posh prompt configuration
# Documentation: https://ohmyposh.dev/docs/

# ------------------------------------------------------------------------------
# General settings
# ------------------------------------------------------------------------------
version: 3
console_title_template: "{{ .Folder }}"
enable_cursor_positioning: true
final_space: true
shell_integration: true

# ------------------------------------------------------------------------------
# Color palette (Tokyo Night inspired)
# ------------------------------------------------------------------------------
palette:
  black: '#000000'
  blue: '#7aa2f7'
  cyan: '#7dcfff'
  darkblue: '#3b4261'
  darkpurple: '#faba4a' #1e1828
  green: '#9ece6a'
  lightblue: '#c0caf5'
  orange: '#faba4a'
  pink: '#c05a93'
  red: '#c53b53'
  white: '#ffffff'

# ------------------------------------------------------------------------------
# Icons (Nerd Font required)
# ------------------------------------------------------------------------------
icons:
  icon_check: &icon_check "\uf00c"                     # ‚òëÔ∏é
  icon_clock: &icon_clock "\uf017"                     # ‚è≤
  icon_computer: &icon_computer " \uf4a9 "             # üíª
  icon_corner_bl: &icon_corner_bl "\u2570\u2500"       # ‚îî‚îÄ
  icon_corner_br: &icon_corner_br "\u2500\u256F"       # ‚îÄ‚îò
  icon_corner_tl: &icon_corner_tl "\u256D\u2500\ue0b2" # ‚îå‚óÄ
  icon_corner_tr: &icon_corner_tr "\ue0b0\u2500\u256E" # ‚ñ∂‚îê
  icon_divider_left: &icon_divider_left "\ue0b3"       # <
  icon_divider_right: &icon_divider_right " \ue0b1"    # >
  icon_edit: &icon_edit "\uf044"                       # üìù
  icon_network: &icon_network " \uef09 "               # network
  icon_floppy: &icon_floppy "\ueb4b"                   # üíæ
  icon_folder: &icon_folder "\uf07c "                  # üìÅ 
  icon_git: &icon_git "\uf126 "                        # git
  icon_python: &icon_python "\ue235 "                  # python
  icon_hourglass: &icon_hourglass "\uf252"             # ‚åõ
  icon_lock: &icon_lock " \uf023 "                     # üîí
  icon_ok: &icon_ok "\uf00c "                          # ‚úî
  icon_triangle_left: &icon_triangle_left "\ue0b2"     # ‚óÄ
  icon_triangle_right: &icon_triangle_right "\ue0b0"   # ‚ñ∂

# ------------------------------------------------------------------------------
# Template variables
# ------------------------------------------------------------------------------
var:
  check: *icon_check
  clock: *icon_clock
  computer: *icon_computer
  divleft: *icon_divider_left
  divright: *icon_divider_right
  edit: *icon_edit
  floppy: *icon_floppy
  folder: *icon_folder
  git: *icon_git
  hourglass: *icon_hourglass
  lock: *icon_lock
  ok: *icon_ok
  python: *icon_python
  network: *icon_network

# ------------------------------------------------------------------------------
# Template strings
# ------------------------------------------------------------------------------
template_strings:
  background_root: &background_root "{{ if .Root }}p:red{{ end }}"
  foreground_root: &foreground_root "{{ if .Root }}p:white{{ end }}"
  background_ssh: &background_ssh "{{ if or .Env.SSH_CONNECTION .Env.SSH_CLIENT .Env.SSH_TTY }}p:orange{{ end }}"
  foreground_ssh: &foreground_ssh "{{ if or .Env.SSH_CONNECTION .Env.SSH_CLIENT .Env.SSH_TTY }}p:black{{ end }}"
  foreground_ssh_inv: &foreground_ssh_inv "{{ if or .Env.SSH_CONNECTION .Env.SSH_CLIENT .Env.SSH_TTY }}p:orange{{ end }}"
  hostname: &hostname " {{ first (splitList \".\" .HostName) }} "
  hosticon: &hosticon "{{ if .SSHSession }}{{ .Var.network }}{{ else }}{{ .Var.computer }}{{ end }} "

# ------------------------------------------------------------------------------
# Transient prompt (shown after command execution)
# ------------------------------------------------------------------------------
transient_prompt:
  background: transparent
  foreground: p:darkblue
  template: "{{ .Shell }}> "

# ------------------------------------------------------------------------------
# Prompt blocks
# ------------------------------------------------------------------------------
blocks:
  
  ## Top left part of the prompt
  - type: prompt
    alignment: left
    force: true
    segments:

      # OS icon
      - type: os
        foreground: p:blue
        background: p:darkblue
        leading_diamond: *icon_corner_tl
        style: diamond
        template: " {{.Icon}}  "
        foreground_templates:
          - *foreground_ssh_inv

      # Current path
      - type: path
        style: powerline
        background: p:blue
        background_templates:
          - "{{ if not .Writable }}p:red{{ end }}"
        foreground: p:darkblue
        foreground_templates:
          - "{{ if not .Writable }}p:white{{ end }}"
        powerline_symbol: *icon_triangle_right
        properties:
          home_icon: "~"
          style: full
        template: "{{ if .Writable }}{{ else }}{{ .Var.lock }}{{ end }} {{ .Path }} "

      # Languages
      - type: python
        style: powerline
        powerline_symbol: *icon_triangle_right
        foreground: p:blue
        background: p:darkblue
        properties:
          display_mode: files
        template: " {{ .Var.python }} "

      # Git status
      # - green: clean
      # - orange: modified
      # - red: diverged
      # - pink: ahead/behind
      - type: git
        background: p:green
        background_templates:
          - "{{ if or (.Working.Changed) (.Staging.Changed) }}p:orange{{ end }}"
          - "{{ if and (gt .Ahead 0) (gt .Behind 0) }}p:red{{ end }}"
          - "{{ if gt .Ahead 0 }}p:pink{{{ end }}"
          - "{{ if gt .Behind 0 }}p:pink{{ end }}"
        foreground: p:black
        foreground_templates:
          - "{{ if or (.Working.Changed) (.Staging.Changed) }}p:black{{ end }}"
          - "{{ if and (gt .Ahead 0) (gt .Behind 0) }}p:white{{ end }}"
        powerline_symbol: *icon_triangle_right
        properties:
          branch_icon: *icon_git
          fetch_stash_count: true
          fetch_status: true
          fetch_upstream_icon: true
        style: powerline
        template: " {{ .HEAD }}{{if .BranchStatus }} {{ .BranchStatus }}{{ end }}{{ if .Working.Changed }} {{ .Var.edit }} {{ .Working.String }}{{ end }}{{ if and (.Working.Changed) (.Staging.Changed) }} |{{ end }}{{ if .Staging.Changed }} {{ .Var.check }} {{ .Staging.String }}{{ end }}{{ if gt .StashCount 0 }} {{ .Var.floppy }} {{ .StashCount }}{{ end }} "
  
  ## Top right part of the prompt
  - type: prompt
    alignment: right
    force: true
    segments:

      # Exit status
      - type: status
        style: powerline
        background: p:green
        background_templates:
          - "{{ if gt .Code 0 }}p:red{{ end }}"
        foreground: p:black
        foreground_templates:
          - "{{ if gt .Code 0 }}p:white{{ end }}"
        invert_powerline: true
        powerline_symbol: *icon_triangle_left
        properties:
          always_enabled: true
        template: " {{ if gt .Code 0 }}{{ reason .Code }}{{ else }}{{ .Var.ok }}{{ end }} "

      # Execution time
      - type: executiontime
        style: powerline
        background: p:orange
        foreground: p:black
        invert_powerline: true
        powerline_symbol: *icon_triangle_left
        template: " {{ .FormattedMs }} {{ .Var.hourglass }} "

      # # Current time
      # - type: time
      #   style: diamond
      #   background: p:darkblue
      #   foreground: p:blue
      #   invert_powerline: true
      #   template: " {{ .CurrentDate | date .Format }} {{ .Var.clock }} "
      #   trailing_diamond: *icon_corner_tr
      #   foreground_templates:
      #     - *foreground_root
      #   background_templates:
      #     - *background_root

      # Username
      - type: session
        style: powerline
        foreground: p:blue
        background: p:darkblue
        invert_powerline: true
        powerline_symbol: *icon_triangle_left
        template: " {{ .UserName }} "
        foreground_templates:
          - "{{ if .SSHSession }}p:orange{{ end }}"
          - *foreground_root
        background_templates:
          - *background_root

      # Hostname
      - type: session
        style: powerline
        foreground: p:darkblue
        background: p:blue
        invert_powerline: true
        powerline_symbol: *icon_triangle_left
        template: *hostname
        foreground_templates:
          - *foreground_ssh
        background_templates:
          - *background_ssh

      # Computer icon
      - type: session
        foreground: p:blue
        background: p:darkblue
        invert_powerline: true
        trailing_diamond: *icon_corner_tr
        style: diamond
        template: *hosticon
        foreground_templates:
          - *foreground_ssh_inv
  
  ## Bottom left part of the prompt
  - type: prompt
    alignment: left
    force: true
    newline: true
    segments:
      - foreground: p:darkblue
        style: plain
        template: *icon_corner_bl
        type: text
  
  ## Bottom right part of the prompt
  - type: rprompt
    alignment: right
    force: true
    segments:
      - foreground: p:darkblue
        style: plain
        template: *icon_corner_br
        type: text
