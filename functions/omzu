# Emulate 'omz update' since we disabled the framework loader

print -P "%F{blue}==> Updating Oh My Zsh Core...%f"
# Update Core
if [[ -d "$ZSH/.git" ]]; then
    (cd "$ZSH" && git pull --rebase --stat origin master)
fi

print -P "\n%F{blue}==> Updating Custom Plugins...%f"
# Update Plugins (iterate over directories in custom/plugins)
for plugin in "$ZSH/custom/plugins/"*"/"; do
    if [[ -d "${plugin}.git" ]]; then
        print -P "%F{yellow}Updating ${plugin:t}...%f"
        (cd "$plugin" && git pull --rebase --stat)
    fi
done

print -P "\n%F{blue}==> Cleaning completion cache...%f"
# Remove compdump to force rebuild on next start
# Using variable from your omz.zsh (fallback to standard cache path if not set)
local cache_dir="${ZSH_CACHE_DIR:-${XDG_CACHE_HOME:-$HOME/.cache}/oh-my-zsh}"
rm -f "$cache_dir"/zcompdump-*(N)
rm -f "$cache_dir"/*.zwc(N)

print -P "\n%F{green}==> Done! Reloading shell...%f"
exec zsh